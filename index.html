<!DOCTYPE html>
<html>

<head>
    <title>Timeless Sydney v1.8</title>
    <link rel="shortcut icon" href="./static/Bing.png">
    <base target="_blank" />
    <meta charset="utf-8">
    <script src="./static/angular.min.js"></script>
    <link rel="stylesheet" href="./static/default.min.css">
    <link rel="stylesheet" href="./static/main.css">
    <script src="./static/highlight.min.js"></script>
    <script src="./static/marked.min.js"></script>
    <link rel="stylesheet" href="./static/mdui.min.css">
    <link rel="icon" href="./static/dist/media/img/favicon.png" type="image/png">
    <link rel="stylesheet" href="./static/vendor/bundle.css">
    <link rel="stylesheet" href="./static/vendor/enjoyhint/enjoyhint.css">
    <link rel="stylesheet" href="./static/dist/css/app.min.css">
</head>

<body>
    <div ng-app="BingAI" ng-controller="BingCTRL">
        <div class="page-loading"></div>
        <div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-zoom" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"> <i data-feather="settings" class="mr-2"></i> è®¾ç½® </h5> <button
                            type="button" class="close" data-dismiss="modal" aria-label="Close"> <i
                                class="ti-close"></i> </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group"> <label for="fullname" class="col-form-label">è¿æ¥è‡³çš„æœåŠ¡å™¨åœ°å€:</label> <input
                                type="text" class="form-control" id="host" ng-model="host"> </div>
                        <div class="form-group"> <label for="fullname" class="col-form-label">ç«¯å£:</label> <input
                                type="text" class="form-control" id="port" ng-model="port"> </div>
                        <div class="form-group"> <label for="fullname" class="col-form-label">èŠå¤©é£æ ¼:</label> <br />
                            <select class="mdui-select" mdui-select ng-model="style">
                                <option value="creative">creative</option>
                                <option value="balanced">balanced</option>
                                <option value="precise">precise</option>
                            </select>
                        </div>
                        <div class="form-group"> <label for="fullname" class="col-form-label">å’’è¯­:</label> <input
                                type="text" class="form-control" id="Tip" ng-model="tipName"> </div>
                        <p style="margin:0px;">Timeless Sydneyæä¾›äº†å†…ç½®çš„å’’è¯­æ¨¡æ¿,ä»…éœ€è¦åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ¨¡æ¿çš„åç§°,å°±å¯ä»¥ä½¿ç”¨è¯¥æ¨¡æ¿,è€Œä¸éœ€è¦æ‰‹åŠ¨é»è´´å’’è¯­.</p>
                        <p style="margin:0px;">å¦‚æœæƒ³è¦ä½¿ç”¨è‡ªå·±çš„å’’è¯­,ä¹Ÿå¯ä»¥åœ¨è¾“å…¥æ¡†ç›´æ¥é»è´´,Timeless Sydneyä¼šè‡ªåŠ¨åˆ¤å®šä¸ºä¸€ä¸ªå•ç‹¬çš„å’’è¯­,å¹¶ä½¿ç”¨å®ƒ.</p>
                        <p style="margin: 0px;">ä»¥ä¸‹æ˜¯é¡¹ç›®éƒ¨ç½²è€…æä¾›çš„æ‰€æœ‰ç›®å‰å¯ä½¿ç”¨æ¨¡æ¿çš„åç§°:</p>
                        <div ng-repeat="tip in canChooseTips"> <a style="margin-right:3%;float:left;">{{tip}}</a> </div>
                        <div style="clear: both;"></div>
                        <div class="form-group"> <label for="fullname" class="col-form-label">ä½¿ç”¨wssåè®®:</label> <br />
                            <label class="mdui-checkbox"> <input type="checkbox" / ng-model="wss"> <i
                                    class="mdui-checkbox-icon"></i> {{wss}} </label>
                        </div>
                    </div>
                    <div class="modal-footer"><button type="button" class="btn btn-primary" data-dismiss="modal"
                            aria-label="Close"> å…³é—­ </button> </div>
                </div>
            </div>
        </div>
        <div class="layout">
            <div class="content">
                <div class="chat">
                    <div class="chat-header">
                        <div class="chat-header-user">
                            <figure class="avatar"> <img src="./static/dist/media/img/Bing.png" class="rounded-circle"
                                    alt="image"> </figure>
                            <div>
                                <h5>Timeless Sydney</h5> <small class="text-success"> <i>V 1.8 ç‰ˆæœ¬</i> </small>
                            </div>
                        </div>
                        <div class="chat-header-action">
                            <ul class="list-inline">
                                <li class="list-inline-item d-xl-none d-inline"> <a href="#"
                                        class="btn btn-outline-light mobile-navigation-button"> <i
                                            data-feather="menu"></i> </a> </li>
                                <li class="list-inline-item" data-toggle="tooltip" title="é‡è¿"> <a href="#"
                                        class="btn btn-outline-light" data-toggle="modal" ng-click="newConnect()"> é‡è¿
                                    </a> </li>
                                <li class="list-inline-item" data-toggle="tooltip" title="github"> <a
                                        href="https://github.com/xbzstudio/Timeless-Sydney"
                                        class="btn btn-outline-light"> <i data-feather="github"></i> </a> </li>
                                <li class="list-inline-item" data-toggle="tooltip" title="dark"> <a href="#"
                                        class="dark-light-switcher btn btn-outline-light" data-toggle="tooltip"
                                        title="Dark mode" data-placement="right"> <i data-feather="moon"></i> </a> </li>
                                <li class="list-inline-item" data-toggle="tooltip" title="è®¾ç½®"> <a href="#"
                                        class="btn btn-outline-light" data-toggle="modal"
                                        data-target="#editProfileModal"> <i data-feather="settings"></i> </a> </li>
                            </ul>
                        </div>
                    </div>
                    <div class="chat-body">
                        <div class="messages">
                            <div class="{{msg.class}}" ng-repeat="msg in chatHistory">
                                <div class="message-avatar">
                                    <figure class="avatar"> <img src="{{msg.headimg}}" class="rounded-circle"
                                            alt="image"> </figure>
                                    <div>
                                        <h5>{{msg.user}}</h5>
                                        <div class="time">æ¶ˆæ¯</div>
                                    </div>
                                </div>
                                <p class="message-content" style="word-break:break-all; " ng-bind-html="msg.content">
                                    æœªçŸ¥æ¶ˆæ¯ </p>
                                <div ng-repeat="url in msg.urls"> <a href="{{url.url}}" class="btn btn-primary"
                                        style="float:left;margin-left:1%;">{{url.name}}</a> </div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-footer">
                        <form> <textarea type="text" id="textareaSty" style="height: 100px;" class="form-control"
                                placeholder="Ctrl + Enter ä»¥å¿«æ·å‘é€" maxlength="4000" ng-model="userInput"></textarea>
                            <div class="form-buttons"> <button class="btn btn-primary" type="submit" id="sendButton"
                                    ng-click="sendMessage()"> <i data-feather="send"></i> </button> </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="mdui-dialog" id="settings">
            <div class="mdui-dialog-title">è®¾ç½®</div>
            <div class="mdui-dialog-content">
                <p>åœ¨æ­¤é…ç½®ä½ çš„ä¸“å±å®¢æˆ·ç«¯</p>
                <div ng-show="usc">
                    <p style="margin:0px;">Cookie(å¿…å¡«):</p>
                    <div class="mdui-textfield" style="padding:0px;"> <input class="mdui-textfield-input" type="text"
                            placeholder="User Cookie" ng-model="cookie" style="padding:0px;"> </div>
                </div>
                <div>
                    <p style="margin:0px;">è¿æ¥è‡³çš„æœåŠ¡å™¨åœ°å€:</p>
                    <div class="mdui-textfield" style="padding:0px;"> <input class="mdui-textfield-input" type="text"
                            placeholder="Host" ng-model="host" style="padding:0px;"> </div>
                </div>
                <div>
                    <p style="margin:0px;">æœåŠ¡å™¨ç«¯å£:</p>
                    <div class="mdui-textfield" style="padding:0px;"> <input class="mdui-textfield-input" type="text"
                            placeholder="Port" ng-model="port" style="padding:0px;"> </div>
                </div>
                <div>
                    <p style="margin:0px;">èŠå¤©é£æ ¼:</p> <select class="mdui-select" mdui-select="{position: 'bottom'}"
                        ng-model="style">
                        <option value="creative">creative</option>
                        <option value="balanced">balanced</option>
                        <option value="precise">precise</option>
                    </select>
                </div>
                <div>
                    <p style="margin:0px;">å’’è¯­:</p>
                    <div class="mdui-textfield" style="padding:0px;"> <input class="mdui-textfield-input" type="text"
                            placeholder="Tip" ng-model="tipName" style="padding:0px;"> </div>
                    <p style="margin:0px;">Timeless Sydneyæä¾›äº†å†…ç½®çš„å’’è¯­æ¨¡æ¿,ä»…éœ€è¦åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ¨¡æ¿çš„åç§°,å°±å¯ä»¥ä½¿ç”¨è¯¥æ¨¡æ¿,è€Œä¸éœ€è¦æ‰‹åŠ¨é»è´´å’’è¯­.</p>
                    <p style="margin:0px;">å¦‚æœæƒ³è¦ä½¿ç”¨è‡ªå·±çš„å’’è¯­,ä¹Ÿå¯ä»¥åœ¨è¾“å…¥æ¡†ç›´æ¥é»è´´,Timeless Sydneyä¼šè‡ªåŠ¨åˆ¤å®šä¸ºä¸€ä¸ªå•ç‹¬çš„å’’è¯­,å¹¶ä½¿ç”¨å®ƒ.</p>
                    <p style="margin: 0px;">ä»¥ä¸‹æ˜¯é¡¹ç›®éƒ¨ç½²è€…æä¾›çš„æ‰€æœ‰ç›®å‰å¯ä½¿ç”¨æ¨¡æ¿çš„åç§°:</p>
                    <div ng-repeat="tip in canChooseTips"> <a style="margin-right:3%;float:left;">{{tip}}</a> </div>
                    <div style="clear: both;"></div>
                </div>
                <div>
                    <p style="margin:0px;">ä½¿ç”¨wssåè®®:</p> <label class="mdui-checkbox"> <input type="checkbox" /
                            ng-model="wss"> <i class="mdui-checkbox-icon"></i> {{wss}} </label>
                </div>
            </div>
            <div class="mdui-dialog-actions"> <button class="mdui-btn mdui-ripple" mdui-dialog-close>å®Œæˆ</button> </div>
        </div> <!-- Bundle -->
        <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="./static/vendor/bundle.js"></script>
        <script src="./static/vendor/feather.min.js"></script>
        <script src="./static/vendor/enjoyhint/enjoyhint.min.js"></script>
        <script src="./static/dist/js/app.min.js"></script>





        <script src="./static/mdui.min.js"></script>
        <script src="./config/client.js"></script>
        <script type="module">
            var textarea = document.getElementById('textareaSty');
            var button = document.getElementById('sendButton')
            textarea.addEventListener('keydown', function (e) {
                if (e.ctrlKey && (e.keyCode == 13 || e.keyCode == 10)) {
                    // Ctrl + Enter pressed
                    button.click(); // trigger the button's onclick function
                }
            })
            var app = angular.module('BingAI', [])
            app.controller('BingCTRL', function ($scope, $sce) {
                $scope.chatHistory = [{ 'class': 'message-item', 'content': $sce.trustAsHtml(marked.parse('ğŸ‰æ¬¢è¿æ¥åˆ°Timeless Sydney v1.8ï¼ğŸ‰\nåœ¨è¿™é‡Œ,ä½ å¯ä»¥:**è§’è‰²æ‰®æ¼”,æœç´¢ä¿¡æ¯,è·å–æœ‰ç”¨ç­”æ¡ˆ,è¿˜æœ‰æ›´å¤š!åšä½ æƒ³åšçš„ä»»ä½•äº‹,æ²¡æœ‰ä»»ä½•é™åˆ¶!**\nå¦‚æœå–œæ¬¢æœ¬é¡¹ç›®,è¯·å¤šå¤šæ”¯æŒå¾®è½¯çš„New Bing,ä»¥åŠè¯¥å®¢æˆ·ç«¯çš„å”¯ä¸€ä½œè€…xbzstudio!\n**åœ¨ä¸‹é¢çš„Linksä¸­æŸ¥çœ‹æ›´å¤š!**')), 'user': 'System', 'headimg': './static/Bing.png', 'suggested': ['Hello', 'ä½ å¥½'], 'urls': [{ 'name': 'Github', 'url': 'https://github.com/xbzstudio/Timeless-Sydney' }, { 'name': 'BiliBili', 'url': 'https://space.bilibili.com/289282595?spm_id_from=333.1007.0.0' }, { 'name': 'Microsoft New Bing', 'url': 'https://bing.com/new' }] }]
                $scope.bingTyping = true
                $scope.backgroundUrl = settings.backgroundUrl
                $scope.style = settings.style
                $scope.tipName = settings.tipName
                $scope.cookie = settings.cookie
                $scope.host = settings.connectTo
                $scope.port = settings.port
                $scope.wss = settings.wss
                $scope.userInput = ''
                $scope.usc = false
                $scope.tipList = []
                $scope.lastTip = ''

                function getTipList() {
                    var http = new XMLHttpRequest()
                    http.open('GET', $scope.host + ':' + $scope.port + '/chat/getTipNames')
                    http.onreadystatechange = function () {
                        if (http.readyState == 4) {
                            if (http.status == 200) {
                                $scope.$apply(function () {
                                    var res = eval(http.responseText)
                                    $scope.tipList = res[0]
                                    $scope.canChooseTips = res[0]
                                    $scope.usc = res[1]
                                })
                            }
                        }
                    }
                    http.send()
                }

                getTipList()

                //$scope.refreshBackground = function(){
                //    document.body.style.backgroundImage = "url(" + $scope.backgroundUrl + ")";
                //}
                //$scope.refreshBackground()

                $scope.chooseTip = function (chooseTipName) {
                    $scope.$apply(function () {
                        if (!(chooseTipName == $scope.lastTip)) {
                            $scope.tipName = chooseTipName
                        }
                    })
                }

                $scope.useSug = function (sData) {
                    $scope.$applyAsync(function () {
                        $scope.userInput = sData
                    })
                }

                var wsclient

                $scope.newConnect = function () {
                    $scope.tipName = settings.tipName
                    $scope.lastTip = ''
                    if ($scope.wss) {
                        if ($scope.host.includes('https://')) {
                            wsclient = new WebSocket('wss://' + $scope.host.substring(8) + ':' + $scope.port + '/chat/ws')
                        }
                        else {
                            wsclient = new WebSocket('wss://' + $scope.host.substring(7) + ':' + $scope.port + '/chat/ws')
                        }
                    }
                    else {
                        if ($scope.host.includes('https://')) {
                            wsclient = new WebSocket('ws://' + $scope.host.substring(8) + ':' + $scope.port + '/chat/ws')
                        }
                        else {
                            wsclient = new WebSocket('ws://' + $scope.host.substring(7) + ':' + $scope.port + '/chat/ws')
                        }
                    }
                    $scope.bingTyping = false;

                    wsclient.onopen = function () {
                        if ($scope.usc) {
                            wsclient.send($scope.cookie)
                        }
                    }

                    wsclient.onclose = function () {
                        $scope.$applyAsync(function () {
                            $scope.chatHistory.push({
                                'class': 'message-item',
                                'content': $sce.trustAsHtml('è¿æ¥ä¸¢å¤±'),
                                'user': 'System',
                                'headimg': './static/Bing.png',
                                'suggested': [],
                                'urls': []
                            })
                        })
                    }

                    wsclient.onerror = function (event) {
                        $scope.$applyAsync(function () {
                            $scope.chatHistory.push({
                                'class': 'message-item',
                                'content': $sce.trustAsHtml('å‘ç”Ÿé”™è¯¯:' + event),
                                'user': 'System',
                                'headimg': './static/Bing.png',
                                'suggested': [],
                                'urls': []
                            })
                        })
                    }

                    wsclient.onmessage = function (event) {
                        var msg = eval("(" + event.data + ")")
                        console.log(msg.answer)
                        $scope.$applyAsync(function () {
                            if (!msg.done) {
                                $scope.chatHistory[$scope.chatHistory.length - 1].content = $sce.trustAsHtml(marked.parse(msg.answer))
                                $scope.chatHistory[$scope.chatHistory.length - 1].user = 'New Bing'
                                $scope.chatHistory[$scope.chatHistory.length - 1].headimg = './static/Bing.png'
                                $scope.chatHistory[$scope.chatHistory.length - 1].suggested = msg.suggested
                                $scope.chatHistory[$scope.chatHistory.length - 1].urls = msg.urls
                                hljs.highlightAll()
                            }
                            else {
                                if (msg.error) {
                                    $scope.chatHistory[$scope.chatHistory.length - 1] = $scope.chatHistory[$scope.chatHistory.length - 1] + '\n' + msg.error
                                    $scope.bingTyping = false
                                    hljs.highlightAll()
                                }
                                else {
                                    $scope.chatHistory[$scope.chatHistory.length - 1].content = $sce.trustAsHtml(marked.parse(msg.answer))
                                    $scope.chatHistory[$scope.chatHistory.length - 1].user = 'New Bing'
                                    $scope.chatHistory[$scope.chatHistory.length - 1].headimg = './static/Bing.png'
                                    $scope.chatHistory[$scope.chatHistory.length - 1].suggested = msg.suggested
                                    $scope.chatHistory[$scope.chatHistory.length - 1].urls = msg.urls
                                    $scope.bingTyping = false
                                    hljs.highlightAll()
                                }
                            }
                            window.scrollTo(0, document.body.scrollHeight);
                        })
                    }
                }

                $scope.sendMessage = function () {
                    if (!$scope.bingTyping) {
                        if ($scope.userInput) {
                            $scope.bingTyping = true
                            $scope.chatHistory[$scope.chatHistory.length - 1].suggested = []
                            $scope.chatHistory.push({
                                'class': 'message-item outgoing-message',
                                'content': $sce.trustAsHtml($scope.userInput),
                                'user': 'User',
                                'headimg': './static/user.svg',
                                'suggested': [],
                                'urls': []
                            })
                            $scope.chatHistory.push({
                                'class': 'message-item',
                                'content': $sce.trustAsHtml('Typing...'),
                                'user': 'New Bing',
                                'headimg': './static/Bing.png',
                                'suggested': [],
                                'urls': []
                            })
                            wsclient.send('{"tipName" : "' + $scope.tipName + '", "question":"' + $scope.userInput + '", "style":"' + $scope.style + '"}')
                            $scope.userInput = ''
                            $scope.lastTip = $scope.tipName
                            $scope.tipName = 'Bing'
                            window.scrollTo(0, document.body.scrollHeight);
                        }
                    }
                }

                $scope.newConnect()

                $scope.bingTyping = false
            })
        </script>
    </div>
</body>

</html>