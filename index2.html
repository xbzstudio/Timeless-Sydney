<!doctype html>
<html>

<head>
    <meta charset="utf-8">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Slek - Chat and Discussion Platform</title>

        <!-- Favicon -->
        <link rel="icon" href="./static/dist/media/img/favicon.png" type="image/png">

        <!-- Bundle Styles -->
        <link rel="stylesheet" href="./static/vendor/bundle.css">

        <link rel="stylesheet" href="./static/vendor/enjoyhint/enjoyhint.css">

        <!-- App styles -->
        <link rel="stylesheet" href="./static/dist/css/app.min.css">
    </head>

<body>

    <!-- page loading -->
    <div class="page-loading"></div>
    <!-- ./ page loading -->

    <!-- page tour modal -->



    <!-- ./ voice call modal -->


    <!-- setting modal -->
    <div class="modal fade" id="settingModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-zoom" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i data-feather="settings" class="mr-2"></i> Settings
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <i class="ti-close"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" href="#account" role="tab"
                                aria-controls="account" aria-selected="true">Account</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#notification" role="tab"
                                aria-controls="notification" aria-selected="false">Notification</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#contact" role="tab" aria-controls="contact"
                                aria-selected="false">Security</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane show active" id="account" role="tabpanel">
                            <div class="form-item custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" checked id="customSwitch1">
                                <label class="custom-control-label" for="customSwitch1">Allow connected contacts</label>
                            </div>
                            <div class="form-item custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" checked id="customSwitch2">
                                <label class="custom-control-label" for="customSwitch2">Confirm message requests</label>
                            </div>
                            <div class="form-item custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" checked id="customSwitch3">
                                <label class="custom-control-label" for="customSwitch3">Profile privacy</label>
                            </div>
                            <div class="form-item custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="customSwitch4">
                                <label class="custom-control-label" for="customSwitch4">Developer mode options</label>
                            </div>
                            <div class="form-item custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" checked id="customSwitch5">
                                <label class="custom-control-label" for="customSwitch5">Two-step security
                                    verification</label>
                            </div>
                        </div>
                        <div class="tab-pane" id="notification" role="tabpanel">
                            <div class="form-item custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" checked id="customSwitch6">
                                <label class="custom-control-label" for="customSwitch6">Allow mobile
                                    notifications</label>
                            </div>
                            <div class="form-item custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="customSwitch7">
                                <label class="custom-control-label" for="customSwitch7">Notifications from your
                                    friends</label>
                            </div>
                            <div class="form-item custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="customSwitch8">
                                <label class="custom-control-label" for="customSwitch8">Send notifications by
                                    email</label>
                            </div>
                        </div>
                        <div class="tab-pane" id="contact" role="tabpanel">
                            <div class="form-item custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="customSwitch9">
                                <label class="custom-control-label" for="customSwitch9">Suggest changing passwords every
                                    month.</label>
                            </div>
                            <div class="form-item custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" checked id="customSwitch10">
                                <label class="custom-control-label" for="customSwitch10">Let me know about suspicious
                                    entries to your account</label>
                            </div>
                            <div class="form-item">
                                <p>
                                    <a class="btn btn-light" data-toggle="collapse" href="#collapseExample"
                                        role="button" aria-expanded="false" aria-controls="collapseExample">
                                        <i data-feather="plus" class="mr-2"></i> Security Questions
                                    </a>
                                </p>
                                <div class="collapse" id="collapseExample">
                                    <div class="form-group">
                                        <input type="text" class="form-control" placeholder="Question 1">
                                    </div>
                                    <div class="form-group">
                                        <input type="text" class="form-control" placeholder="Answer 1">
                                    </div>
                                    <div class="form-group">
                                        <input type="text" class="form-control" placeholder="Question 2">
                                    </div>
                                    <div class="form-group">
                                        <input type="text" class="form-control" placeholder="Answer 2">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary">Save</button>
                </div>
            </div>
        </div>
    </div>
    <!-- ./ setting modal -->

    <!-- edit profile modal -->
    <div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-zoom" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i data-feather="edit-2" class="mr-2"></i> Edit Profile
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <i class="ti-close"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" href="#personal" role="tab"
                                aria-controls="personal" aria-selected="true">Personal</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#about" role="tab" aria-controls="about"
                                aria-selected="false">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#social-links" role="tab"
                                aria-controls="social-links" aria-selected="false">Social Links</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane show active" id="personal" role="tabpanel">
                            <form>
                                <div class="form-group">
                                    <label for="fullname" class="col-form-label">Fullname</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="fullname">
                                        <div class="input-group-append">
                                            <span class="input-group-text">
                                                <i data-feather="user"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-form-label">Avatar</label>
                                    <div class="d-flex align-items-center">
                                        <div>
                                            <figure class="avatar mr-3 item-rtl">
                                                <img src="./static/dist/media/img/man_avatar4.jpg"
                                                    class="rounded-circle" alt="image">
                                            </figure>
                                        </div>

                                        <div class="custom-file">
                                            <input type="file" class="custom-file-input" id="customFile">
                                            <label class="custom-file-label" for="customFile">Choose file</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="city" class="col-form-label">City</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="city" placeholder="Ex: Columbia">
                                        <div class="input-group-append">
                                            <span class="input-group-text">
                                                <i data-feather="target"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="phone" class="col-form-label">Phone</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="phone"
                                            placeholder="(555) 555 55 55">
                                        <div class="input-group-append">
                                            <span class="input-group-text">
                                                <i data-feather="phone"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="website" class="col-form-label">Website</label>
                                    <input type="text" class="form-control" id="website" placeholder="https://">
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane" id="about" role="tabpanel">
                            <form>
                                <div class="form-group">
                                    <label for="about-text" class="col-form-label">Write a few words that describe
                                        you</label>
                                    <textarea class="form-control" id="about-text"></textarea>
                                </div>
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" checked id="customCheck1">
                                    <label class="custom-control-label" for="customCheck1">View profile</label>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane" id="social-links" role="tabpanel">
                            <form>
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Username">
                                        <div class="input-group-append">
                                            <span class="input-group-text bg-facebook">
                                                <i class="ti-facebook"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Username">
                                        <div class="input-group-append">
                                            <span class="input-group-text bg-twitter">
                                                <i class="ti-twitter"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Username">
                                        <div class="input-group-append">
                                            <span class="input-group-text bg-instagram">
                                                <i class="ti-instagram"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Username">
                                        <div class="input-group-append">
                                            <span class="input-group-text bg-linkedin">
                                                <i class="ti-linkedin"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Username">
                                        <div class="input-group-append">
                                            <span class="input-group-text bg-dribbble">
                                                <i class="ti-dribbble"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Username">
                                        <div class="input-group-append">
                                            <span class="input-group-text bg-youtube">
                                                <i class="ti-youtube"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Username">
                                        <div class="input-group-append">
                                            <span class="input-group-text bg-google">
                                                <i class="ti-google"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Username">
                                        <div class="input-group-append">
                                            <span class="input-group-text bg-whatsapp">
                                                <i class="fa fa-whatsapp"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary">Save</button>
                </div>
            </div>
        </div>
    </div>
    <!-- ./ edit profile modal -->

    <!-- layout -->
    <div class="layout">
        <div class="content">
            <div class="chat">
                <div class="chat-header">
                    <div class="chat-header-user">
                        <figure class="avatar">
                            <img src="./static/dist/media/img/Bing.png" class="rounded-circle" alt="image">
                        </figure>
                        <div>
                            <h5>Timeless Sydney</h5>
                            <small class="text-success">
                                <i>V 1.8 版本</i>
                            </small>
                        </div>
                    </div>
                    <div class="chat-header-action">
                        <ul class="list-inline">
                            <li class="list-inline-item d-xl-none d-inline">
                                <a href="#" class="btn btn-outline-light mobile-navigation-button">
                                    <i data-feather="menu"></i>
                                </a>
                            </li>
                            <li class="list-inline-item" data-toggle="tooltip" title="github">
                                <a href="https://github.com/xbzstudio/Timeless-Sydney" class="btn btn-outline-light">
                                    <i data-feather="github"></i>
                                </a>
                            </li>
                            <li class="list-inline-item" data-toggle="tooltip" title="dark">
                                <a href="#" class="dark-light-switcher btn btn-outline-light" data-toggle="tooltip" title="Dark mode"
                                    data-placement="right">
                                    <i data-feather="moon"></i>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="#" class="btn btn-outline-light" data-toggle="dropdown">
                                    <i data-feather="more-horizontal"></i>
                                </a>
                                <div class="dropdown-menu">
                                    <a href="#" class="dropdown-item" data-toggle="modal"
                                        data-target="#editProfileModal">Edit
                                        profile</a>
                                    <a href="#" class="dropdown-item" data-toggle="modal"
                                        data-target="#settingModal">Settings</a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="chat-body"> 
                    <div class="messages">
                        <div class="message-item outgoing-message">

                            <div class="message-content">
                                Hello how are you?
                            </div>
                        </div>
                        <div class="message-item">
                            <div class="message-avatar">
                                <figure class="avatar">
                                    <img src="./static/dist/media/img/Bing.png" class="rounded-circle" alt="image">
                                </figure>
                                <div>
                                    <h5>Timeless Sydney</h5>
                                    <div class="time">01:35 PM</div>
                                </div>
                            </div>
                            <div class="message-content">
                                I'm fine, how are you 😃
                            </div>
                        </div>

                        <div class="message-item messages-divider sticky-top" data-label="Today"></div>

                        <div class="message-item messages-divider" data-label="1 message unread"></div>

                    </div>
                </div>
                <div class="chat-footer">
                    <form>
                        <input type="text" class="form-control" placeholder="Write a message.">
                        <div class="form-buttons">

                            <button class="btn btn-primary" type="submit">
                                <i data-feather="send"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
          



        </div>
 

    </div>


    <!-- Bundle -->
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="./static/vendor/bundle.js"></script>
    <script src="./static/vendor/feather.min.js"></script>
    <script src="./static/vendor/enjoyhint/enjoyhint.min.js"></script>

    <!-- App scripts -->
    <script src="./static/dist/js/app.min.js"></script>

    <!-- Examples 
<script src="./static/dist/js/examples.js"></script>-->
</body>

</html>


<script src="./config/client.js"></script>
<script type="module">
    var textarea = document.getElementById('textareaSty');
    var button = document.getElementById('sendButton')
    textarea.addEventListener('keydown', function (e) {
        if (e.ctrlKey && (e.keyCode == 13 || e.keyCode == 10)) {
            // Ctrl + Enter pressed
            button.click(); // trigger the button's onclick function
        }
    })
    var app = angular.module('BingAI', [])
    app.controller('BingCTRL', function ($scope, $sce) {
        $scope.chatHistory = [{
            'content': $sce.trustAsHtml(marked.parse('🎉欢迎来到Timeless Sydney v1.8！🎉\n在这里,你可以:**角色扮演,搜索信息,获取有用答案,还有更多!做你想做的任何事,没有任何限制!**\n如果喜欢本项目,请多多支持微软的New Bing,以及该客户端的唯一作者xbzstudio!\n**在下面的Links中查看更多!**')),
            'user': 'System',
            'headimg': './static/Bing.png',
            'suggested': ['Hello', '你好'],
            'urls': [{ 'name': 'Github', 'url': 'https://github.com/xbzstudio/Timeless-Sydney' },
            { 'name': 'BiliBili', 'url': 'https://space.bilibili.com/289282595?spm_id_from=333.1007.0.0' },
            { 'name': 'Microsoft New Bing', 'url': 'https://bing.com/new' }
            ]
        }]
        $scope.bingTyping = true
        $scope.backgroundUrl = settings.backgroundUrl
        $scope.style = settings.style
        $scope.tipName = settings.tipName
        $scope.cookie = settings.cookie
        $scope.host = settings.connectTo
        $scope.port = settings.port
        $scope.wss = settings.wss
        $scope.userInput = ''
        $scope.usc = false
        $scope.tipList = []
        $scope.lastTip = ''

        function getTipList() {
            var http = new XMLHttpRequest()
            http.open('GET', $scope.host + ':' + $scope.port + '/chat/getTipNames')
            http.onreadystatechange = function () {
                if (http.readyState == 4) {
                    if (http.status == 200) {
                        $scope.$apply(function () {
                            var res = eval(http.responseText)
                            $scope.tipList = res[0]
                            $scope.canChooseTips = res[0]
                            $scope.usc = res[1]
                        })
                    }
                }
            }
            http.send()
        }

        getTipList()

        $scope.refreshBackground = function () {
            document.body.style.backgroundImage = "url(" + $scope.backgroundUrl + ")";
        }
        $scope.refreshBackground()

        $scope.chooseTip = function (chooseTipName) {
            $scope.$apply(function () {
                if (!(chooseTipName == $scope.lastTip)) {
                    $scope.tipName = chooseTipName
                }
            })
        }

        $scope.useSug = function (sData) {
            $scope.$applyAsync(function () {
                $scope.userInput = sData
            })
        }

        var wsclient

        $scope.newConnect = function () {
            $scope.tipName = settings.tipName
            $scope.lastTip = ''
            if ($scope.wss) {
                if ($scope.host.includes('https://')) {
                    wsclient = new WebSocket('wss://' + $scope.host.substring(8) + ':' + $scope.port + '/chat/ws')
                }
                else {
                    wsclient = new WebSocket('wss://' + $scope.host.substring(7) + ':' + $scope.port + '/chat/ws')
                }
            }
            else {
                if ($scope.host.includes('https://')) {
                    wsclient = new WebSocket('ws://' + $scope.host.substring(8) + ':' + $scope.port + '/chat/ws')
                }
                else {
                    wsclient = new WebSocket('ws://' + $scope.host.substring(7) + ':' + $scope.port + '/chat/ws')
                }
            }
            $scope.bingTyping = false;

            wsclient.onopen = function () {
                if ($scope.usc) {
                    wsclient.send($scope.cookie)
                }
            }

            wsclient.onclose = function () {
                $scope.$applyAsync(function () {
                    $scope.chatHistory.push({
                        'content': $sce.trustAsHtml('❌连接丢失❌'),
                        'user': 'System',
                        'headimg': './static/Bing.png',
                        'suggested': [],
                        'urls': []
                    })
                })
            }

            wsclient.onerror = function (event) {
                $scope.$applyAsync(function () {
                    $scope.chatHistory.push({
                        'content': $sce.trustAsHtml('发生错误:' + event),
                        'user': 'System',
                        'headimg': './static/Bing.png',
                        'suggested': [],
                        'urls': []
                    })
                })
            }

            wsclient.onmessage = function (event) {
                var msg = eval("(" + event.data + ")")
                console.log(msg.answer)
                $scope.$applyAsync(function () {
                    if (!msg.done) {
                        $scope.chatHistory[$scope.chatHistory.length - 1].content = $sce.trustAsHtml(marked.parse(msg.answer))
                        $scope.chatHistory[$scope.chatHistory.length - 1].user = 'New Bing'
                        $scope.chatHistory[$scope.chatHistory.length - 1].headimg = './static/Bing.png'
                        $scope.chatHistory[$scope.chatHistory.length - 1].suggested = msg.suggested
                        $scope.chatHistory[$scope.chatHistory.length - 1].urls = msg.urls
                        hljs.highlightAll()
                    }
                    else {
                        if (msg.error) {
                            $scope.chatHistory[$scope.chatHistory.length - 1] = $scope.chatHistory[$scope.chatHistory.length - 1] + '\n' + msg.error
                            $scope.bingTyping = false
                            hljs.highlightAll()
                        }
                        else {
                            $scope.chatHistory[$scope.chatHistory.length - 1].content = $sce.trustAsHtml(marked.parse(msg.answer))
                            $scope.chatHistory[$scope.chatHistory.length - 1].user = 'New Bing'
                            $scope.chatHistory[$scope.chatHistory.length - 1].headimg = './static/Bing.png'
                            $scope.chatHistory[$scope.chatHistory.length - 1].suggested = msg.suggested
                            $scope.chatHistory[$scope.chatHistory.length - 1].urls = msg.urls
                            $scope.bingTyping = false
                            hljs.highlightAll()
                        }
                    }
                    window.scrollTo(0, document.body.scrollHeight);
                })
            }
        }

        $scope.sendMessage = function () {
            if (!$scope.bingTyping) {
                if ($scope.userInput) {
                    $scope.bingTyping = true
                    $scope.chatHistory[$scope.chatHistory.length - 1].suggested = []
                    $scope.chatHistory.push({
                        'content': $sce.trustAsHtml($scope.userInput),
                        'user': 'User',
                        'headimg': './static/User.png',
                        'suggested': [],
                        'urls': []
                    })
                    $scope.chatHistory.push({
                        'content': $sce.trustAsHtml('Typing...'),
                        'user': 'New Bing',
                        'headimg': './static/Bing.png',
                        'suggested': [],
                        'urls': []
                    })
                    wsclient.send('{"tipName" : "' + $scope.tipName + '", "question":"' + $scope.userInput + '", "style":"' + $scope.style + '"}')
                    $scope.userInput = ''
                    $scope.lastTip = $scope.tipName
                    $scope.tipName = 'Bing'
                    window.scrollTo(0, document.body.scrollHeight);
                }
            }
        }

        $scope.newConnect()

        $scope.bingTyping = false
    })
</script>